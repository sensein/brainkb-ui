#EntityView:
id: ui:1
name: CellTaxon_card
slug: celltaxon
# description: a view of a cell taxon
boxes:
  - box:
    slug: summarybox
    id: ui:2
    name: Summary
    cardtype: card
    box_header:
      key: name                  # so the header shows the label
    sparql_query: |-
        PREFIX NIMP: <http://example.org/NIMP/>
        PREFIX prov: <http://www.w3.org/ns/prov#>
        PREFIX biolink: <https://w3id.org/biolink/vocab/>
        PREFIX rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX rdfs:  <http://www.w3.org/2000/01/rdf-schema#>
        PREFIX bican: <https://identifiers.org/brain-bican/vocab/>
        PREFIX DHBA:  <https://purl.brain-bican.org/ontology/dmbao/DMBA_>
        SELECT DISTINCT ?name ?xref ?parentNode WHERE {
          GRAPH <https://apitesting.com/> {
            BIND(<{0}> AS ?id)
            ?id a bican:CellTypeTaxon .
            OPTIONAL { ?id rdfs:label ?name . }
            OPTIONAL { ?id biolink:xref ?xref . }
            OPTIONAL { ?id bican:has_parent ?parentNode . }

          }
        }

    box_additional_info:
      header: Abbreviations
      is_iterable: true
      properties:
        - key: Abbreviations
          sparql_query: |-
            PREFIX bican: <https://identifiers.org/brain-bican/vocab/>
            PREFIX rdfs:  <http://www.w3.org/2000/01/rdf-schema#>

            SELECT
              ?abbrNode
              ?abbrTerm
              ?abbrMeaning
              (GROUP_CONCAT(DISTINCT STR(?parcellationTerm); separator=", ") AS ?parcellationTerms)
              (GROUP_CONCAT(DISTINCT STR(?geneAnnotation);   separator=", ") AS ?geneAnnotations)
              (GROUP_CONCAT(DISTINCT STR(?cellType);         separator=", ") AS ?cellTypes)
            WHERE {
              GRAPH <https://apitesting.com/> {
                VALUES ?id { <urn:bkbit:71e0a3dc10f0d41bcbba139f47a4921da20b78ef6cee9eccbdf465565249def4> }

                # Only abbreviations actually linked to this id
                ?id bican:has_abbreviation ?abbrNode .

                # One row per abbrNode (term/meaning are single-valued per node)
                ?abbrNode a bican:Abbreviation ;
                          bican:term    ?abbrTerm ;
                          bican:meaning ?abbrMeaning .

                # Denotations (may be 0..many) â€” aggregate them
                OPTIONAL { ?abbrNode bican:denotes_parcellation_term ?parcellationTerm . }
                OPTIONAL { ?abbrNode bican:denotes_gene_annotation    ?geneAnnotation . }
                OPTIONAL { ?abbrNode bican:denotes_cell_type          ?cellType . }
              }
            }
            GROUP BY ?abbrNode ?abbrTerm ?abbrMeaning
            ORDER BY ?abbrNode

        # - key: SpatialRegionalProportions
        #   sparql_query: |-
        #     PREFIX bican: <https://identifiers.org/brain-bican/vocab/>

        #     SELECT DISTINCT
        #       ?srp_node
        #       ?srp_str
        #       ?srp_gpe
        #       ?srp_gpi
        #       ?srp_sn
        #       ?srp_adj
        #       ?srp_sth
        #     WHERE {
        #       GRAPH <https://apitesting.com/> {
        #         VALUES ?id { <{0}> }
        #         OPTIONAL {
        #           ?id bican:spatial_regional_proportions ?srp_node .
        #           ?srp_node a bican:SpatialProportions .
        #           OPTIONAL { ?srp_node bican:str ?srp_str . }
        #           OPTIONAL { ?srp_node bican:gpe ?srp_gpe . }
        #           OPTIONAL { ?srp_node bican:gpi ?srp_gpi . }
        #           OPTIONAL { ?srp_node bican:sn  ?srp_sn  . }
        #           OPTIONAL { ?srp_node bican:adj ?srp_adj . }
        #           OPTIONAL { ?srp_node bican:sth ?srp_sth . }
        #         }
        #       }
        #     }
